
<div id="cookie-popup" role="dialog" aria-modal="true" aria-labelledby="cookie-title" aria-describedby="cookie-desc" style="position: fixed; bottom: 1rem; left: 0; right: 0; margin: 0 auto; max-width: 420px; background: #fff; color: #055142; border: 2px solid #055142; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.15); z-index: 2000; padding: 1.5rem; display: none;">
  <h2 id="cookie-title" style="font-size: 1.2rem; margin-bottom: .5em;">Gestion des cookies</h2>
  <p id="cookie-desc" style="font-size: 1rem; margin-bottom: 1em;">
    Nous utilisons des cookies pour améliorer votre expérience et mesurer l’audience. Vous pouvez accepter, refuser ou personnaliser vos choix. <a href="cookies.html" style="color: #055142; text-decoration: underline;">En savoir plus</a>.
  </p>
  <form id="cookie-form">
    <fieldset style="border: none; padding: 0; margin-bottom: 1em;">
      <legend style="font-weight: bold; font-size: 1rem;">Préférences</legend>
      <div>
        <input type="checkbox" id="cookie-essentiels" checked disabled aria-disabled="true" />
        <label for="cookie-essentiels">Cookies essentiels (obligatoires)</label>
      </div>
      <div>
        <input type="checkbox" id="cookie-mesure" name="cookie-mesure" />
        <label for="cookie-mesure">Mesure d’audience (anonyme)</label>
      </div>
      <div>
        <input type="checkbox" id="cookie-marketing" name="cookie-marketing" />
        <label for="cookie-marketing">Marketing personnalisé</label>
      </div>
    </fieldset>
    <div style="display: flex; gap: .5em; flex-wrap: wrap;">
      <button type="submit" id="cookie-accept-all" style="background: #055142; color: #fff; border: none; border-radius: 4px; padding: .5em 1em; cursor: pointer;">Tout accepter</button>
      <button type="button" id="cookie-refuse-all" style="background: #fff; color: #055142; border: 2px solid #055142; border-radius: 4px; padding: .5em 1em; cursor: pointer;">Tout refuser</button>
      <button type="button" id="cookie-save" style="background: #eee; color: #055142; border: 1px solid #055142; border-radius: 4px; padding: .5em 1em; cursor: pointer;">Enregistrer mes choix</button>
    </div>
  </form>
</div>
<!-- Fin popup cookie - John Doe -->

<script>
// Accessibilité : focus piégé dans la popup
function trapFocus(element) {
  const focusable = element.querySelectorAll('button, [href], input:not([disabled]), [tabindex]:not([tabindex="-1"])');
  const first = focusable[0];
  const last = focusable[focusable.length - 1];
  element.addEventListener('keydown', function(e) {
    if (e.key === 'Tab') {
      if (e.shiftKey) { if (document.activeElement === first) { e.preventDefault(); last.focus(); } }
      else { if (document.activeElement === last) { e.preventDefault(); first.focus(); } }
    }
    if (e.key === 'Escape') {
      // Optionnel : ne pas permettre de fermer sans choix
    }
  });
}

// Affichage conditionnel si pas de consentement
if (!localStorage.getItem('cookieConsent')) {
  const popup = document.getElementById('cookie-popup');
  popup.style.display = 'block';
  popup.setAttribute('tabindex', '-1');
  popup.focus();
  trapFocus(popup);
}

// Gestion des boutons
document.getElementById('cookie-accept-all').onclick = function(e) {
  e.preventDefault();
  localStorage.setItem('cookieConsent', JSON.stringify({mesure: true, marketing: true}));
  document.getElementById('cookie-popup').style.display = 'none';
};
document.getElementById('cookie-refuse-all').onclick = function() {
  localStorage.setItem('cookieConsent', JSON.stringify({mesure: false, marketing: false}));
  document.getElementById('cookie-popup').style.display = 'none';
};
document.getElementById('cookie-save').onclick = function() {
  const mesure = document.getElementById('cookie-mesure').checked;
  const marketing = document.getElementById('cookie-marketing').checked;
  localStorage.setItem('cookieConsent', JSON.stringify({mesure, marketing}));
  document.getElementById('cookie-popup').style.display = 'none';
};
document.getElementById('cookie-form').onsubmit = function(e) {
  e.preventDefault();
  document.getElementById('cookie-save').click();
};
</script>
